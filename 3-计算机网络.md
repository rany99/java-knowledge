# 计算机网络

[TOC]

## 0 网络层

**<font color='red'>网络层用于实现主机之间跨网（物理链路）的转发和交付</font>**

![image-20230412170317562](C:\Users\a3781\AppData\Roaming\Typora\typora-user-images\image-20230412170317562.png)

![image-20230412170325601](C:\Users\a3781\AppData\Roaming\Typora\typora-user-images\image-20230412170325601.png)

**版本：**

4位，指定IP协议的版本号、

**首部长度(IHL)：**

4位，IP协议包头的长度，指明IPV4协议包头长度的字节数包含多少个32位。由于IPV4的包头可能包含可变数量的可选项，所以这个字段可以用来确定IPV4数据报中数包部分的偏移位置。IPV4包头的最小长度是20个字节，因此IHL这个字段的最小值用视频之表示就是5（5×4 = 20 字节）。即他表示的事包头的总字节数是四字节的倍数。

**服务类型(QoS)：**

定义IP协议包的处理办法，它包含以下字段

- 过程字段：3位，设置了数据包的重要性，取值越大数据就越重要，取值范围：0（正常）-7（网络控制）
- 延迟字段：1位，取值：0（正常）、1（期特低的延迟）
- 流量字段：1位，取值：0（正常）、1（期待高的流量）
- 可靠性字段：1位，取值：0（正常）、1（期特高的可靠性）
- 成本字段：1位，取值：0（正常）、1（期特最小成本）
- 未使用：1位

**长度：**

IP包的总长

**标识：**

唯一标识一个IP分组的序号（防止重复）

**标志：**

是一个3位的控制字段，包含：

- 保留为：1位
- 不分段位：1位，取值：0（允许数据包分段）、1（数据包不能分段）
- 更多段位：1位，取值：0（数据包后没有包，该包为最后的包）、1（数据包后面有更多的包）

**段偏移量：**

当数据分组时，它和更多段位进行连接，帮助目的主机将分段的包组合

**TTL：**

表示数据报在网络上生存多久，每通过一个路由器该值减一，为0时江北路由器丢弃

**协议：**

8位，这个字段定义了IP数据报的数据部分使用的协议类型。常用的协议及其十进制数值包括：ICMP(1)、TCP(6)、UDP(17)。

**校验和：**

16位，是IPV4数据包包头的校验和

**源IP地址：**

**目的IP地址：**

## 1 传输层

**<font color='red'>传输层为应用层提供服务，用于实现进程到进程之间的通信，同时可以实现流量、拥塞、差错控制等</font>**

### 1.1 TCP和UDP

#### TCP和UDP的区别

- TCP有连接，UDP无连接协议；TCP只能点对点，UDP可以点对多点通信；
- 延迟和开销不同（TCP头部最少20字节，UDP只有8字节），UDP处理简单；
- TCP面向字节流传输，UDP面向用户数据报传输；这要求应用层做不同处理（TCP存在粘包/拆包问题）；
- TCP可以实现按序、可靠交付；UDP不保证上述特性；
- TCP可以实现流量控制、拥塞控制、差错控制，UDP无法实现，只提供简单的校验和
- 适用场景不同：
  - UDP：应用层数据较短（超过 65535 Byte则需要拆分成对个UDP，应用程序需要自行控制时序并合并分组）、不要求绝对可靠性（可以在应用层做可靠性保证）、要求低延时。例如：DNS、RIP、DHCP、实时音视频流等多播协议。
  - TCP：文件传输等。例如：SSH、FTP

![image-20230412175026122](C:\Users\a3781\AppData\Roaming\Typora\typora-user-images\image-20230412175026122.png)

两种协议的首部格式：

![image-20230412175335374](C:\Users\a3781\AppData\Roaming\Typora\typora-user-images\image-20230412175335374.png)

> - UDP最大数据长度为65535-28（sendto函数如果传入数据超过阈值则返回错误），长度过大则IP层会分包，一个fragment分组传送有问题，整个package消息就会丢弃。
>
> - TCP接收窗口最大为65535，发送窗口取决于min(拥塞窗口， 对端的接收窗口)。

### 1.2 三次握手和四次挥手

![image-20230412175548242](C:\Users\a3781\AppData\Roaming\Typora\typora-user-images\image-20230412175548242.png)
